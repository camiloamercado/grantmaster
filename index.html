<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grant Master | Contract Review Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #0d4a6b;
            --primary-dark: #093a54;
            --red: #dc2626;
            --orange: #ea580c;
            --gray: #6b7280;
            --light: #f9fafb;
            --card: #ffffff;
            --border: #e5e7eb;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
            line-height: 1.5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--primary);
            color: white;
            border-radius: 12px;
        }
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        header p {
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        .input-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .input-section h2 {
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        textarea {
            width: 100%;
            height: 200px;
            padding: 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: inherit;
            font-size: 15px;
            resize: vertical;
        }
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px 28px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 15px;
            transition: background 0.2s;
        }
        .btn:hover { background: var(--primary-dark); }
        .btn i { margin-right: 6px; }

        /* Results */
        .results {
            display: none;
            animation: fadeIn 0.4s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Checklist Table */
        .checklist {
            overflow-x: auto;
            margin-bottom: 40px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        th, td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        th {
            background: var(--primary);
            color: white;
            font-weight: 600;
        }
        tr:last-child td { border-bottom: none; }
        .section-header {
            background: #f0f9ff;
            color: var(--primary);
            font-weight: 700;
        }
        .flag-red { color: var(--red); font-weight: bold; }
        .flag-orange { color: var(--orange); font-weight: bold; }
        .flag-gray { color: var(--gray); }

        /* Summary */
        .summary {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .summary h2 {
            color: var(--primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .flags-summary {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .flag-box {
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
        }
        .flag-red-box { background: #fee2e2; color: var(--red); }
        .flag-orange-box { background: #ffedd5; color: var(--orange); }
        .flag-gray-box { background: #f3f4f6; color: var(--gray); }

        /* Email Draft */
        .email-draft {
            background: #f8fafc;
            border-left: 4px solid var(--primary);
            padding: 20px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 14px;
            line-height: 1.6;
        }
        .email-header {
            font-weight: bold;
            color: var(--primary);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-file-contract"></i> GRANT MASTER</h1>
            <p>Contract & Grant Agreement Review Assistant ‚Äî Auto-flag RED/ORANGE/GRAY risks for GMU clearance</p>
        </header>

        <section class="input-section">
            <h2><i class="fas fa-paste"></i> Paste Contract or Grant Agreement Text</h2>
            <textarea id="contract-text" placeholder="Paste the full contract, grant agreement, or Terms of Reference (TOR) here. 
Include: whereas clauses, payment terms, reporting schedules, legal provisions, annexes, etc."></textarea>
            <button class="btn" onclick="analyzeContract()"><i class="fas fa-magic"></i> Analyze Agreement</button>
        </section>

        <div id="results" class="results">
            <div class="flags-summary">
                <div class="flag-box flag-red-box">
                    üî¥ RED FLAGS: <span id="red-count">0</span>
                </div>
                <div class="flag-box flag-orange-box">
                    üü† ORANGE FLAGS: <span id="orange-count">0</span>
                </div>
                <div class="flag-box flag-gray-box">
                    ‚ö™ GRAY FLAGS: <span id="gray-count">0</span>
                </div>
            </div>

            <div class="checklist">
                <table>
                    <thead>
                        <tr>
                            <th width="40%">Review Item</th>
                            <th width="10%">Flag</th>
                            <th width="50%">Comments / Auto-Detection</th>
                        </tr>
                    </thead>
                    <tbody id="checklist-body">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>

            <div class="summary">
                <h2><i class="fas fa-envelope"></i> Clearance Email Draft</h2>
                <div class="email-draft" id="email-draft">
‚úÖ Grant Master Review Complete.  
‚ö†Ô∏è Please find key flags requiring attention below:

[Auto-generated after analysis ‚Äî click "Analyze Agreement" above]
                </div>
                <button class="btn" onclick="copyEmail()" style="margin-top: 15px;">
                    <i class="fas fa-copy"></i> Copy Email Draft
                </button>
            </div>
        </div>
    </div>

    <script>
        // Your exact checklist ‚Äî structured for auto-analysis
        const CHECKLIST = [
            // === GENERAL GRANT INFORMATION ===
            {
                section: "GENERAL GRANT INFORMATION",
                items: [
                    { q: "Donor", flag: "gray", key: "donor", detect: /donor:\s*([\w\s\-]+)/i },
                    { q: "Lead donor (if any)", flag: "gray", key: "lead_donor", detect: /lead donor|back[\s\-]funder/i },
                    { q: "Project title", flag: "gray", key: "title", detect: /project title[:\-]?\s*([^\n]+)/i },
                    { q: "Start and end date; grant duration", flag: "gray", key: "dates", detect: /start.*date|end.*date|duration.*month/i },
                    { q: "Grant amount and currency", flag: "gray", key: "amount", detect: /\$[\d,]+|‚Ç¨[\d,]+|USD|EUR|grant amount/i },
                    { q: "Sub-lever, Project leader", flag: "gray", key: "pl", detect: /project leader|sub[\s\-]lever/i },
                    { q: "GMU Reviewer", flag: "gray", key: "reviewer", detect: /gmu reviewer/i },
                    { q: "Date", flag: "gray", key: "review_date", detect: /date:\s*\d{1,2}\/\d{1,2}\/\d{4}/i },
                    { q: "General comments", flag: "gray", key: "comments" }
                ]
            },

            // === BASIC CONTRACTUAL INFORMATION ===
            {
                section: "BASIC CONTRACTUAL INFORMATION",
                items: [
                    { q: "TOR aligned with proposal?", flag: "orange", detect: /terms of reference|tor.*align/i },
                    { q: 'Whereas includes Bioversity/CIAT legal status wording?', flag: "red", detect: /bioversity international.*1991|ciat.*1986|host country agreement/i },
                    { q: "Proposal budget annexed?", flag: "orange", detect: /budget annex|annexed budget|P number/i },
                    { q: "Defined payment schedule?", flag: "gray", detect: /payment schedule|tranche|disbursement schedule/i },
                    { q: "Payment terms clearly outlined?", flag: "gray", detect: /payment terms|conditions/i },
                    { q: "Intra-Alliance Grant?", flag: "orange", detect: /intra[\s\-]alliance|mirror grant/i },
                    { q: "Project period matches proposal?", flag: "orange", detect: /project period|start.*end date/i },
                    { q: "Locations correct per proposal?", flag: "orange", detect: /locations|countries|jurisdictions/i },
                    { q: "Co-financing % matches proposal?", flag: "orange", detect: /co[\s\-]financing|co[\s\-]fund/i },
                    { q: "Proposal docs (logframe, workplan) annexed?", flag: "orange", detect: /logframe|workplan|proposal documents/i },
                    { q: "Full-period funding or year-by-year?", flag: "orange", detect: /year[\s\-]by[\s\-]year|continuing grant|WCE/i },
                    { q: "Donor focal points identified?", flag: "gray", detect: /focal point|point of contact/i },
                    { q: "Correct bank account listed?", flag: "red", detect: /bank account|iban|swift/i }
                ]
            },

            // === REPORTING REQUIREMENTS ===
            {
                section: "REPORTING REQUIREMENTS",
                items: [
                    { q: "Reporting schedule reasonable? (‚â•60 days)", flag: "red", detect: /report.*due|deadline|within\s*\d+\s*days/i },
                    { q: "Programmatic report formats reasonable?", flag: "orange", detect: /report format|template/i },
                    { q: "Financial report formats reasonable?", flag: "orange", detect: /financial report.*format/i },
                    { q: "Additional reports requested? (e.g., vouchers)", flag: "orange", detect: /voucher|timesheet|transaction list/i },
                    { q: "Audited statements deadline feasible? (by 30 June)", flag: "orange", detect: /audited.*statement|annual report.*deadline/i },
                    { q: "Project audits budgeted?", flag: "orange", detect: /project audit/i },
                    { q: "Co-financing reporting required?", flag: "gray", detect: /co[\s\-]financing.*report/i }
                ]
            },

            // === FINANCIAL CONDITIONS ===
            {
                section: "FINANCIAL CONDITIONS",
                items: [
                    { q: "Budget flexibility ‚â•¬±10%?", flag: "orange", detect: /budget.*flexibility|variance|¬±\s*\d+%/i },
                    { q: "Ineligible costs specified?", flag: "gray", detect: /ineligible cost/i },
                    { q: "Overhead/CSP allowed? (15% / 2.04%)", flag: "orange", detect: /overhead|CSP|indirect cost/i },
                    { q: "Institutional costs (RSS, FAC, IT) allowed?", flag: "orange", detect: /RSS|FAC|IT cost/i },
                    { q: "Donor procurement rules differ?", flag: "red", detect: /donor procurement|own procurement procedure/i },
                    { q: "Donor asset management rules differ?", flag: "orange", detect: /asset management|disposal rule/i },
                    { q: "Record retention ‚â§10 years?", flag: "red", detect: /retain.*record|archiv.*year/i },
                    { q: "Tax obligations clarified?", flag: "red", detect: /tax|VAT|withholding tax/i },
                    { q: "Exchange rate provision clear?", flag: "orange", detect: /exchange rate|currency conversion/i },
                    { q: "Retroactive expenses accepted?", flag: "gray", detect: /retroactive|back[\s\-]date/i },
                    { q: "Interest clause acceptable?", flag: "red", detect: /interest|unspent funds/i },
                    { q: "Financial submission via donor platform?", flag: "gray", detect: /donor portal|online platform/i },
                    { q: "Third-party audit rights beyond agreement?", flag: "red", detect: /third party.*audit|inspect.*records/i }
                ]
            },

            // === LEGAL CONDITIONS ===
            {
                section: "LEGAL CONDITIONS",
                items: [
                    { q: "Amendment process outlined?", flag: "gray", detect: /amend|modify.*agreement/i },
                    { q: "Suspension clause (7-day notice)?", flag: "orange", detect: /suspend|suspension clause/i },
                    { q: "Termination clause (60-day notice, 15-day cure)?", flag: "orange", detect: /terminate|termination.*notice/i },
                    { q: "Agreement template acceptable? (No 'service fee' model)", flag: "red", detect: /service agreement|fee for service/i },
                    { q: "Immunities preserved? (No waiver)", flag: "red", detect: /immunity|waiver.*privilege/i },
                    { q: "Applicable law: neutral (UNIDROIT) preferred", flag: "orange", detect: /governing law|applicable law/i },
                    { q: "Arbitration: 3-person, ICC/UNCITRAL, English", flag: "orange", detect: /arbitration|ICC|UNCITRAL/i },
                    { q: "IP provisions acceptable?", flag: "orange", detect: /intellectual property|background IP/i },
                    { q: "Data management (FAIR, Open Access) acceptable?", flag: "gray", detect: /data management|FAIR|open access/i },
                    { q: "Confidentiality clause acceptable?", flag: "orange", detect: /confidential|non[\s\-]disclosure/i },
                    { q: "Indemnity clause acceptable? (No consequential damages)", flag: "red", detect: /indemnify|indemnity|consequential damage/i },
                    { q: "Liquidated damages/penalties?", flag: "red", detect: /penalty|liquidated damage/i },
                    { q: "Donor policies imposed on Alliance?", flag: "red", detect: /comply with.*donor policy|code of conduct.*donor/i },
                    { q: "Insurance provisions acceptable?", flag: "red", detect: /insurance|liability|professional indemnity/i },
                    { q: "Force Majeure clause acceptable?", flag: "gray", detect: /force majeure/i }
                ]
            },

            // === OTHER SECTIONS (simplified) ===
            {
                section: "COMMUNICATIONS AND VISIBILITY",
                items: [
                    { q: "Visibility conditions match proposal?", flag: "gray", detect: /visibility|branding|logo/i }
                ]
            },
            {
                section: "PARTNERSHIP AND SUB-GRANTS",
                items: [
                    { q: "Partner budget matches internal approval?", flag: "orange", detect: /sub[\s\-]grant|partner budget/i }
                ]
            },
            {
                section: "HUMAN RESOURCES",
                items: [
                    { q: "HR requests (staff time, recruitment, etc.)?", flag: "gray", detect: /staff time|recruitment|key personnel/i }
            ]}
        ];

        function analyzeContract() {
            const text = document.getElementById('contract-text').value.trim();
            if (!text) {
                alert("‚ö†Ô∏è Please paste the agreement text first.");
                return;
            }

            let html = '';
            let red = 0, orange = 0, gray = 0;
            let findings = [];

            CHECKLIST.forEach(group => {
                // Section header
                html += `<tr class="section-header"><td colspan="3">${group.section}</td></tr>`;
                
                group.items.forEach(item => {
                    let flagClass = '';
                    let comment = 'Not detected';
                    let detected = false;

                    if (item.detect && text.match(item.detect)) {
                        detected = true;
                        comment = '‚úÖ Detected in text';
                        // Apply flag logic
                        if (item.flag === 'red') {
                            flagClass = 'flag-red';
                            red++;
                            findings.push(`üî¥ RED: ${item.q}`);
                        } else if (item.flag === 'orange') {
                            flagClass = 'flag-orange';
                            orange++;
                            findings.push(`üü† ORANGE: ${item.q}`);
                        } else {
                            flagClass = 'flag-gray';
                            gray++;
                        }
                    } else {
                        if (item.flag === 'red') {
                            flagClass = 'flag-red';
                            red++;
                            comment = '‚ö†Ô∏è Missing ‚Äî RED FLAG';
                            findings.push(`üî¥ RED: ${item.q} ‚Äî NOT FOUND`);
                        } else if (item.flag === 'orange') {
                            flagClass = 'flag-orange';
                            orange++;
                            comment = '‚ö†Ô∏è Not detected ‚Äî ORANGE FLAG';
                            findings.push(`üü† ORANGE: ${item.q} ‚Äî NOT FOUND`);
                        } else {
                            flagClass = 'flag-gray';
                            gray++;
                            comment = '‚ö™ Not required / informational';
                        }
                    }

                    html += `
                        <tr>
                            <td><strong>${item.q}</strong></td>
                            <td><span class="${flagClass}">${detected ? '‚úÖ' : item.flag === 'red' ? 'üî¥' : item.flag === 'orange' ? 'üü†' : '‚ö™'}</span></td>
                            <td>${comment}</td>
                        </tr>
                    `;
                });
            });

            document.getElementById('checklist-body').innerHTML = html;
            document.getElementById('red-count').textContent = red;
            document.getElementById('orange-count').textContent = orange;
            document.getElementById('gray-count').textContent = gray;

            // Generate email draft
            let email = `‚úÖ Grant Master Automated Review Complete\n\n`;
            email += `üîç Summary: ${red} RED, ${orange} ORANGE, ${gray} GRAY flags\n\n`;
            
            if (findings.length > 0) {
                email += `‚ö†Ô∏è Key Flags Requiring Attention:\n`;
                findings.forEach(f => email += `- ${f}\n`);
            } else {
                email += `‚úÖ No critical flags detected. Proceed with standard clearance.\n`;
            }

            email += `\nüìå Next Steps:\n`;
            email += `- RED flags: Escalate to Legal & PLANS for approval\n`;
            email += `- ORANGE flags: Flag in clearance email for PLANS/PI awareness\n`;
            email += `- Verify missing documents (budget, logframe, etc.) in PBI/Proposals masterfile\n\n`;
            email += `Prepared by: Grant Master Assistant | ${new Date().toLocaleDateString()}`;

            document.getElementById('email-draft').textContent = email;
            document.getElementById('results').style.display = 'block';
        }

        function copyEmail() {
            const email = document.getElementById('email-draft').textContent;
            navigator.clipboard.writeText(email).then(() => {
                const btn = event.target;
                const orig = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                setTimeout(() => btn.innerHTML = orig, 2000);
            });
        }
    </script>
</body>
</html>
